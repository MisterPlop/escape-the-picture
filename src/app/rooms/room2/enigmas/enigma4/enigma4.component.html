<div class="enigma4-container">
  <app-story-intro [text]="storyText"></app-story-intro>

  <div class="enigma-header">
    <h2>√ânigme 4</h2>
    <button class="hint-btn" (click)="toggleHint()">{{ showHint() ? '‚úï' : 'üí°' }} Indice</button>
  </div>

  @if (showHint()) {
  <div class="hint-box">
    <p>
      Concentrez-vous sur les anachronismes, le num√©rique n'√©tait pas encore d'actualit√© √† cette
      √©poque... La cl√© se trouve peut-√™tre ici ! Lisez bien les indices... Tous ne sont pas bons √†
      prendre.
    </p>
  </div>
  } @if (!puzzleSolved()) {
  <!-- Image avec zones cliquables -->
  <div class="image-container">
    <img src="assets/images/enigme-4.png" alt="Indices visuels" class="clue-image" />

    <!-- Zones cliquables superpos√©es (rectangles invisibles) -->
    @for (clue of clues(); track clue.id) {
    <div
      class="clue-zone"
      [class.discovered]="clue.discovered"
      [style.left.%]="clue.x"
      [style.top.%]="clue.y"
      [style.width.px]="clue.width"
      [style.height.px]="clue.height"
      (click)="onClueClick(clue)"
      [title]="clue.discovered ? '‚úì D√©couvert' : 'Cliquez pour d√©couvrir'"
    ></div>
    }
  </div>

  <!-- Panneau des indices d√©couverts (vrais ET faux) -->
  <div class="clues-panel">
    <h3>Indices d√©couverts</h3>
    @if (discoveredRealClues.length === 0) {
    <p class="no-clues">Cliquez sur l'image pour d√©couvrir les indices...</p>
    } @else {
    <div class="clues-grid">
      @for (clue of discoveredRealClues; track clue.id) {
      <div class="clue-card">
        <h4>{{ clue.title }}</h4>
        <p>{{ clue.content }}</p>
      </div>
      }
    </div>
    }
  </div>

  <!-- Section d'entr√©e de la date -->
  <div class="date-input-section">
    <label for="birthdate">Date :</label>
    <input
      type="text"
      id="birthdate"
      [value]="userDate()"
      (input)="formatDateInput($event)"
      (keypress)="onKeyPress($event)"
      (blur)="checkDate()"
      (keyup.enter)="checkDate()"
      placeholder="09/11/2001"
      maxlength="10"
      class="date-input"
      [class.error]="dateAttemptFailed()"
    />
    <button type="button" class="validate-btn" (click)="checkDate()">Valider</button>
  </div>
  @if (dateAttemptFailed()) {
  <div class="error-message">‚ùå Ce n'est pas la bonne date. R√©essayez !</div>
  } } @else {
  <!-- Message de succ√®s -->
  <div class="success-message">
    <div class="success-icon">‚úì</div>
    <h3>Bravo !</h3>
    <p>Vous avez trouv√© la date de naissance de Pablo Picasso : 25 octobre 1881</p>
  </div>
  }
</div>
