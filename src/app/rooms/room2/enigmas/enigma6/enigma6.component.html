<div class="enigma6-container">
  <app-story-intro [text]="storyText"></app-story-intro>

  <div class="enigma-header">
    <h2>√ânigme 6</h2>
    <button class="hint-btn" (click)="toggleHint()">{{ showHint() ? '‚úï' : 'üí°' }} Indice</button>
  </div>

  @if (showHint()) {
  <div class="hint-box">
    <p>
      Observez les formes et les indices... Tout semble rond, mais quel est le mouvement artistique
      de Picasso ?
    </p>
  </div>
  } @if (!puzzleSolved()) {
  <!-- Image avec zones cliquables -->
  <div class="image-container">
    <img src="assets/images/enigme-6.png" alt="Indices visuels" class="clue-image" />

    <!-- Zones cliquables superpos√©es (rectangles invisibles) -->
    @for (clue of clues(); track clue.id) {
    <div
      class="clue-zone"
      [class.discovered]="clue.discovered"
      [style.left.%]="clue.x"
      [style.top.%]="clue.y"
      [style.width.px]="clue.width"
      [style.height.px]="clue.height"
      (click)="onClueClick(clue)"
      [title]="clue.discovered ? '‚úì D√©couvert' : 'Cliquez pour d√©couvrir'"
    ></div>
    }
  </div>

  <!-- Panneau des indices d√©couverts -->
  <div class="clues-panel">
    <h3>Indices d√©couverts</h3>
    @if (discoveredClues.length === 0) {
    <p class="no-clues">Cliquez sur l'image pour d√©couvrir les indices...</p>
    } @else {
    <div class="clues-grid">
      @for (clue of discoveredClues; track clue.id) {
      <div class="clue-card">
        <h4>{{ clue.title }}</h4>
        <p>{{ clue.content }}</p>
      </div>
      }
    </div>
    }
  </div>

  <!-- Section d'entr√©e de r√©ponse -->
  <div class="answer-input-section">
    <label for="answer">Mouvement :</label>
    <input
      type="text"
      id="answer"
      [value]="userAnswer()"
      (input)="formatInput($event)"
      (keypress)="onKeyPress($event)"
      (blur)="checkAnswer()"
      (keyup.enter)="checkAnswer()"
      placeholder="Naturisme"
      class="answer-input"
      [class.error]="answerAttemptFailed()"
    />
    <button type="button" class="validate-btn" (click)="checkAnswer()">Valider</button>
  </div>

  @if (rickrollActive()) {
    <app-rickroll-video></app-rickroll-video>
  }

  @if (answerAttemptFailed()) {
    <div class="error-message">‚ùå Ce n'est pas le bon mouvement artistique. R√©essayez !</div>
  } } @else {
  <!-- Message de succ√®s -->
  <div class="success-message">
    <div class="success-icon">‚úì</div>
    <h3>Bravo !</h3>
    <p>Pablo Picasso est le co-fondateur du mouvement Cubiste !</p>
  </div>
  }
</div>
