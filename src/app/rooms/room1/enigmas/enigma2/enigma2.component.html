<div class="enigma2-container">
  <app-story-intro [text]="storyText"></app-story-intro>

  <div class="enigma-header">
    <h2>√ânigme 2</h2>
    <button class="hint-btn" (click)="toggleHint()">{{ showHint() ? '‚úï' : 'üí°' }} Indice</button>
  </div>

  @if (showHint()) {
  <div class="hint-box">
    <p>Explorez les zones noires pour d√©couvrir les couleurs cach√©es...</p>
    <p>Cliquez sur les mots r√©v√©l√©s puis d√©composer les couleurs d'un pixel.</p>
    <p>Utilisez les codes hexad√©cimaux d√©compos√©s pour reconstituer la couleur finale.</p>
    <p>üí° Astuce : Le # est obligatoire dans votre r√©ponse !</p>
  </div>
  }

  <!-- Conteneur principal avec les deux zones -->
  <div class="main-zones-container" [class.both-revealed]="areBothZonesRevealed()">
    <!-- Zone rouge (2/3) -->
    <div
      class="red-zone"
      (mousemove)="onRedZoneMouseMove($event)"
      [style.--mouse-x.px]="redZoneMouseX()"
      [style.--mouse-y.px]="redZoneMouseY()"
      [class.revealed]="redZoneRevealed()"
    >
      <div class="color-overlay"></div>
      <div class="zone-content">
        <p
          class="zone-text"
          (click)="onRedZoneClick()"
          [style.top.%]="getRedTextTop()"
          [style.left.%]="getRedTextLeft()"
        >
          {{ redZoneRevealed() ? getRedHex() : 'Andalous' }}
        </p>
      </div>
    </div>

    <!-- Zone jaune (1/3) -->
    <div
      class="yellow-zone"
      (mousemove)="onYellowZoneMouseMove($event)"
      [style.--mouse-x.px]="yellowZoneMouseX()"
      [style.--mouse-y.px]="yellowZoneMouseY()"
      [class.revealed]="yellowZoneRevealed()"
    >
      <div class="color-overlay"></div>
      <div class="zone-content">
        <p
          class="zone-text"
          (click)="onYellowZoneClick()"
          [style.top.%]="getYellowTextTop()"
          [style.left.%]="getYellowTextLeft()"
        >
          {{ yellowZoneRevealed() ? getYellowHex() : 'Guernica' }}
        </p>
      </div>
    </div>
  </div>

  <!-- Section de m√©lange des couleurs - affich√©e seulement apr√®s avoir cliqu√© sur les deux zones -->
  @if (redZoneRevealed() && yellowZoneRevealed()) {
  <div class="color-mixer-section">
    <div class="color-result-container">
      <div class="color-result-box" [style.background-color]="getMixedColor()"></div>
      <p class="hex-display">{{ getHexColor() }}</p>
    </div>

    <div class="color-slider-container">
      <div class="slider-group">
        <label for="red-slider">Rouge ({{ redValue() }})</label>
        <input
          type="range"
          id="red-slider"
          min="0"
          max="255"
          [value]="redValue()"
          (input)="updateRedValue($event)"
          class="color-slider red-slider"
        />
      </div>

      <div class="slider-group">
        <label for="green-slider">Vert ({{ greenValue() }})</label>
        <input
          type="range"
          id="green-slider"
          min="0"
          max="255"
          [value]="greenValue()"
          (input)="updateGreenValue($event)"
          class="color-slider green-slider"
        />
      </div>

      <div class="slider-group">
        <label for="blue-slider">Bleu ({{ blueValue() }})</label>
        <input
          type="range"
          id="blue-slider"
          min="0"
          max="255"
          [value]="blueValue()"
          (input)="updateBlueValue($event)"
          class="color-slider blue-slider"
        />
      </div>
    </div>
  </div>
  }

  <!-- Section de guess -->
  <div class="guess-section">
    <div class="input-group">
      <input
        type="text"
        [(ngModel)]="colorGuess"
        placeholder="#8B4513"
        class="color-input"
        [class.error]="attemptFailed()"
        (keyup.enter)="onGuessSubmit()"
      />
      <button class="submit-btn" (click)="onGuessSubmit()" [disabled]="!colorGuess()">
        Valider
      </button>
    </div>

    @if (attemptFailed()) {
    <div class="error-message">‚ùå Ce n'est pas le bon code. R√©essayez !</div>
    } @if (redZoneRevealed() && yellowZoneRevealed() && showHint()) {
    <div class="hint-after-reveal">
      üí° D√©composez chaque code hexa en RGB : {{ getRedHex() }} = R+G+B. Additionnez les composantes
      pour obtenir la couleur finale !
    </div>
    }
  </div>

  <!-- Message de succ√®s -->
  @if (isSuccess()) {
  <div class="success-overlay">
    <div class="success-message">
      <div class="success-content">
        <span class="success-icon">üé®</span>
        <h3>Bravo !</h3>
        <p>Vous avez trouv√© la couleur myst√®re !</p>
        <p class="color-name">¬´ Terre d'Argile ¬ª</p>
        <div class="color-sample" [style.background-color]="'#DF986C'"></div>
      </div>
    </div>
  </div>
  }
</div>
